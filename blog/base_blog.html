<!doctype html>
<html>

<head>
  <meta name="description" content="Jules Berman's Blog" />
  <meta charset="utf-8" />
  <title>Jules Berman | Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="author" content="jmb" />
  <link rel="stylesheet" href="/reset.css">
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/light.css" />
  <!-- Include Marked.js for Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- Include MathJax for LaTeX rendering -->
  <script>
    // Configure MathJax before it loads
    window.MathJax = {
      startup: {
        pageReady: () => {
          return MathJax.startup.defaultPageReady().then(() => {
            // This will be called when MathJax is fully loaded
            if (window.mathJaxReady) {
              window.mathJaxReady();
            }
          });
        }
      },
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        processEscapes: true
      }
    };
  </script>
  <script id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <!-- Header Component -->
  <script src="/components/header-component.js"></script>
</head>

<body>
  <div class="root">
    <header-component current-page="blog"></header-component>

    <div class="content">


      <div id="blog-content" class="blog-content">
        <div class="loading">Loading post...</div>
      </div>
      <a href="/blog/index.html" class="back-to-blog">‚Üê Back to Blog</a>
    </div>
  </div>

  <script>
    // Function to load blog post content
    async function loadBlogPost() {
      // Get post ID from URL hash (e.g., #stochastic_lifting)
      const postHash = window.location.hash.substring(1);
      const postSlug = postHash || new URLSearchParams(window.location.search).get('post');

      if (!postSlug) {
        // If no post is specified, redirect to blog index
        window.location.href = '/blog/index.html';
        return;
      }

      try {
        // Fetch the markdown file
        const response = await fetch(`/blog/posts/${postSlug}.md`);

        if (!response.ok) {
          throw new Error('Post not found');
        }

        const markdown = await response.text();

        // Configure marked to prevent it from processing LaTeX content
        const renderer = new marked.Renderer();
        const originalTextRenderer = renderer.text.bind(renderer);
        renderer.text = (text) => {
          // Don't process content within $ or $$ delimiters (LaTeX math)
          return originalTextRenderer(text);
        };

        // Setup options for marked
        const markedOptions = {
          renderer: renderer,
          mangle: false,
          headerIds: false,
          breaks: true
        };

        // Parse the markdown content
        const rendered = marked.parse(markdown, markedOptions);

        // Update the blog content
        document.getElementById('blog-content').innerHTML = rendered;

        // Typeset with MathJax - either immediately if loaded, or queue it
        const typesetMath = () => {
          if (window.MathJax && window.MathJax.typesetPromise) {
            MathJax.typesetPromise().catch(err => console.error('MathJax typeset error:', err));
          } else {
            console.warn('MathJax not fully loaded yet, will retry...');
            setTimeout(typesetMath, 100);
          }
        };

        // Start the typesetting process
        typesetMath();
      } catch (error) {
        console.error('Error loading blog post:', error);
        document.getElementById('blog-content').innerHTML = `
          <div class="error">
            <h2>Error Loading Post</h2>
            <p>Sorry, there was an error loading the requested blog post.</p>
            <p>${error.message}</p>
            <p><a href="/blog/index.html">Return to Blog Index</a></p>
          </div>
        `;
      }
    }

    // Handle link clicks to prevent full page reload
    document.addEventListener('click', function (event) {
      const link = event.target.closest('a[data-post]');
      if (link) {
        event.preventDefault();
        const postSlug = link.getAttribute('data-post');
        window.location.hash = postSlug;
        loadBlogPost();
      }
    });

    // Load post when the page loads
    document.addEventListener('DOMContentLoaded', loadBlogPost);

    // Reload when the hash changes (if someone changes the URL)
    window.addEventListener('hashchange', loadBlogPost);
  </script>



</body>

</html>